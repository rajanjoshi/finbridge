{% extends "base.html" %}
{% load static %}
{% block content %}
{% load i18n %}

<div class="container mt-5">
  <h2 class="text-center mb-4">{% trans "Financial Inclusion Quiz" %}</h2>

  {% if quiz_questions %}
    <form method="post" action="{% url 'submit_quiz' %}" id="quiz-form">
      {% csrf_token %}
      {% for q in quiz_questions %}
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">Q{{ forloop.counter }}: {{ q.question }}</h5>
            {% for opt in q.options %}
              <div class="form-check">
                <input class="form-check-input" type="radio" name="answer_{{ forloop.parentloop.counter0 }}"
                       id="q{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}" value="{{ opt }}">
                <label class="form-check-label" for="q{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}">
                  {{ opt }}
                </label>
              </div>
            {% endfor %}
            <input type="hidden" name="correct_{{ forloop.counter0 }}" value="{{ q.answer }}">
          </div>
        </div>
      {% endfor %}
      <button type="submit" class="btn btn-primary btn-lg w-100">✅ {% trans "Submit Answers" %}</button>
    </form>
  {% else %}
    <div class="alert alert-warning text-center">
      ⚠️ No quiz questions available. Please try again later.
    </div>
  {% endif %}
</div>
{% endblock %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.querySelector("form").addEventListener("submit", function (e) {
    const totalQuestions = {{ quiz_questions|length }};
    let allAnswered = true;

    for (let i = 0; i < totalQuestions; i++) {
      const options = document.getElementsByName(`q${i}`);
      const answered = Array.from(options).some(opt => opt.checked);
      if (!answered) {
        allAnswered = false;
        break;
      }
    }

    if (!allAnswered) {
      e.preventDefault(); // stop form submission
      Swal.fire({
        icon: 'warning',
        title: 'Hold on!',
        text: 'Please answer all questions before submitting the quiz.',
      });
    }
  });
</script>
